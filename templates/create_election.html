{% extends "base.html" %}

{% block title %}Choose Category{% endblock %}

{% block pre_content %}
    {% include 'partials/back_button.html' %}
{% endblock %}

{% block content %}
    <h1 class="text-center my-4">Choose Voting Category</h1>

    {% if category == 'restaurant' %}
        <!-- Restaurant voting section -->
        <form method="POST" action="{{ url_for('start_restaurant_election') }}">
            <div class="form-group">
                <label for="city">City</label>
                <input type="text" class="form-control mb-2" id="city" name="city" required>
            </div>
            <div class="form-group">
                <label for="state">State</label>
                <input type="text" class="form-control mb-2" id="state" name="state" required>
            </div>
            <div class="form-group">
                <label for="number_of_restaurants">Number of Restaurants</label>
                <input type="number" class="form-control mb-2" id="number_of_restaurants" name="number_of_restaurants" min="1" required>
            </div>
            <div class="form-group">
                <label for="max_votes">Maximum Votes</label>
                <input type="number" class="form-control mb-2" id="max_votes" name="max_votes" min="1" required>
            </div>
            <div class="form-group">
                <label for="admin_id">Admin ID</label> <!-- Link the admin who starts the election -->
                <select class="form-control mb-2" id="admin_id" name="admin_id">
                    {% for admin in admins %}
                        <option value="{{ admin.id }}">{{ admin.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" name="generate_restaurants" value="generate_restaurants" class="btn btn-warning btn-block mb-2">Generate Restaurants</button>
        </form>
    {% elif category == 'custom' %}
        <!-- Custom candidate voting section -->
        <form method="POST" action="{{ url_for('start_custom_election') }}">
            <div class="form-group">
                <label for="number_of_custom_candidates">Number of Candidates</label>
                <input type="number" class="form-control mb-2" id="number_of_custom_candidates" name="number_of_custom_candidates" min="1" required oninput="generateCandidateFields()">
            </div>

            <div id="custom_candidates_container"></div>

            <div class="form-group">
                <label for="max_votes_custom">Maximum Votes</label>
                <input type="number" class="form-control mb-2" id="max_votes_custom" name="max_votes_custom" min="1" required>
            </div>

            <div class="form-group">
                <label for="admin_id">Admin ID</label> <!-- Admin field added -->
                <select class="form-control mb-2" id="admin_id" name="admin_id">
                    {% for admin in admins %}
                        <option value="{{ admin.id }}">{{ admin.username }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn btn-primary btn-block mb-2">Start Election with Custom Candidates</button>
        </form>
    {% endif %}
{% endblock %}

{% block extra_scripts %}
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
    <script>
        // Generates custom candidate input fields dynamically
        function generateCandidateFields() {
            let number_of_custom_candidates = document.getElementById("number_of_custom_candidates").value;
            let container = document.getElementById("custom_candidates_container");

            if (isNaN(number_of_custom_candidates) || number_of_custom_candidates <= 0) {
                alert('Please enter a valid number of candidates.');
                return;
            }

            container.innerHTML = ''; // Clear previous fields
            
            for (let i = 1; i <= number_of_custom_candidates; i++) {
                let candidateField = `
                    <div class="form-group">
                        <label for="candidate_${i}">Candidate ${i} Name</label>
                        <input type="text" class="form-control mb-2" id="candidate_${i}" name="candidate_${i}" required>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', candidateField);
            }
        }
    </script>
{% endblock %}
